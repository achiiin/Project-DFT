"""
To break SMILES down into building blocks
Input: 1. SMILES files (one per row)
       2. SMARTS files (one per row)
output: csv file (SMILES,..,..,..,..,.....)
"""

import pandas as pd 
import pybel

## load input files ##
list_SMILES = [] 
with open("uni_SMILES_300.txt") as f:
    for i in f:
        str_smiles = i.strip()
        list_SMILES.append(str_smiles)
f.close()
list_BB = []   
with open("BB_SMARTS.txt") as f:
    for i in f:
        str_SMARTS = i.strip()
        list_BB.append(str_SMARTS)
f.close()
################################
list_index = [i for i in range(1,len(list_BB)+1)]
#list_smart = ['[#6]~1~[#6]~[#6]~[#6]~[#6]~[#6]~1','[#16]~1~[#6]~[#6]~[#6]~[#6]~1','[#14]~1~[#6]~[#6]~[#6]~[#6]~1','[#34]~1~[#6]~[#6]~[#6]~[#6]~1','[#7]~1~[#6]~[#6]~[#6]~[#6]~1', #1~5
#              '[#8]~1~[#6]~[#6]~[#6]~[#6]~1', '[#6]~1~[#6]~[#6]~[#6]~[#6]~1','[#16]~1~[#6]~[#6]~2~[#6](~[#6]~1)~[#6]~[#6]~[#16]~2', '[#6]~1~[#6]~[#6]~2~[#6](~[#14]~1)~[#6]~[#16]~[#6]~2','[#16]~1~[#6]~[#6]~2~[#6](~[#6]~1)~[#6]~[#6]~[#34]~2',  #6~10
#              '[#16]~1~[#6]~[#6]~2~[#6](~[#6]~1)~[#6]~[#6]~[#7]~2', '[#16]~1~[#6]~[#6]~2~[#6](~[#6]~1)~[#6]~[#6]~[#8]~2', '[#16]~1~[#6]~[#6]~2~[#6](~[#6]~1)~[#6]~[#6]~[#6]~2', '[#16]~1~[#6]~[#6]~2~[#6](~[#6]~1)~[#7]~[#6]~[#6]~[#7]~2','[#16]~1~[#7]~[#6]~2~[#6](~[#7]~1)~[#6]~[#6]~[#6]~[#6]~2',  #11~15
#              '[#6]~1~[#6]~[#6]~[#6]~[#6]~2~[#6]~1~[#6]~[#6]~[#6]~[#6]~2','[#7]~1~[#6]~[#6]~[#6]~[#6]~[#6]~1','[#6]~1~[#7]~[#6]~[#7]~[#6]~[#7]~1','[#6]~1~[#6]~[#7]~[#6]~[#16]~1', '[#6]~1~2~[#6](~[#6]~3~[#6](~[#6]~4~[#6]~1~[#6]~[#6]~[#6]~[#6]~4)~[#6]~[#6]~[#6]~[#6]~3)~[#6]~[#16]~[#6]~2',  #16~20
#              '[#6]~1~[#6]~[#6]~[#6]~[#6]~2~[#6]~1~[#6]~[#16]~[#6]~2','[#6]~1~[#6]~[#6]~[#6]~[#6]~2~[#6]~1~[#6]~[#7]~[#6]~2','[#6]~1~[#6]~[#6]~[#6]~[#6]~2~[#6]~1~[#6]~[#8]~[#6]~2','[#6]~1~[#6]~[#6]~[#6]~[#6]~2~[#6]~1~[#6]~[#14]~[#6]~2','[#6]~1~[#6]~[#6]~[#6]~[#6]~2~[#6]~1~[#6]~[#6]~[#6]~2',  #21~25
#              '[#6]~1~[#6]~2~[#6](~[#6]~[#7]~[#6]~1)~[#7]~[#16]~[#7]~2']
dic_smart = dict(zip(list_index, list_BB))
##################################
dic_numbb = {}
for i in dic_smart:
    for smiles in list_SMILES:        
        mol = pybel.readstring("smi", smiles)
        smarts = pybel.Smarts(dic_smart[i].strip())
        smarts.obsmarts.Match(mol.OBMol)
        num_unique_matches = len(smarts.findall(mol))
        dic_numbb.setdefault(smiles,[]).append(num_unique_matches)
        

df_1 = pd.DataFrame.from_dict(dic_numbb,orient='index')
df_1.to_csv("results.csv",header=False,index=True)



        
        
        
        
        
        
        
        